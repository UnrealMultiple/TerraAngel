--- src/Terraria/Terraria/Main.cs
+++ src/TerraAngel/Terraria/Main.cs
@@ -24,7 +_,6 @@
 using ReLogic.Graphics;
 using ReLogic.Localization.IME;
 using ReLogic.OS;
-using ReLogic.Peripherals.RGB;
 using ReLogic.Threading;
 using ReLogic.Utilities;
 using Terraria.Achievements;
@@ -200,8 +_,6 @@
     public static bool CaptureModeDisabled = false;
     public bool unityMouseOver;
     public static Main instance;
-    public static ChromaEngine Chroma;
-    public static ChromaHotkeyPainter ChromaPainter;
     public static Camera Camera = new Camera();
     public static IPlayerRenderer PlayerRenderer = new LegacyPlayerRenderer();
     public static IPlayerRenderer PotionOfReturnRenderer = new ReturnGatePlayerRenderer();
@@ -698,7 +_,8 @@
     public static float invAlpha = 1f;
     public static float invDir = 1f;
     [ThreadStatic]
-    public static UnifiedRandom rand;
+    public static UnifiedRandom _rand;
+    public static UnifiedRandom rand { get { if (_rand is null) { _rand = new UnifiedRandom(); } return _rand; } set { _rand = value; } }
     public static bool allChestStackHover;
     public static bool inventorySortMouseOver;
     public static bool bestiaryMouseOver;
@@ -857,7 +_,7 @@
     public static HairstyleUnlocksHelper Hairstyles = new HairstyleUnlocksHelper();
     public static bool tilesLoaded = false;
     public static WorldMap Map;
-    public static Tile[,] tile = new Tile[maxTilesX, maxTilesY];
+    public static NativeTileMap tile = new NativeTileMap(maxTilesX, maxTilesY);
     public static Dust[] dust = new Dust[6001];
     public static Star[] star = new Star[400];
     public static WorldItem[] item = new WorldItem[401];
@@ -881,7 +_,6 @@
     public static int screenHeight = 864;
     public static bool screenMaximized = true;
     public static bool screenBorderless = true;
-    public static int screenBorderlessPendingResizes;
     public static int teamNamePlateDistance = 2000;
     public static int multiplayerNPCSmoothingRange = 300;
     public static bool Setting_UseReducedMaxLiquids = false;
@@ -961,8 +_,8 @@
     public static WorkshopPublishingIndicator WorkshopPublishingIndicator = new WorkshopPublishingIndicator();
     public static IssueReportsIndicator IssueReporterIndicator = new IssueReportsIndicator();
     public static bool Support4K = true;
-    private static int _renderTargetMaxSize = 2048;
-    private static GraphicsProfile _selectedGraphicsProfile = ((!Program.IsXna) ? GraphicsProfile.HiDef : GraphicsProfile.Reach);
+    private static int _renderTargetMaxSize = 8192;
+    private static GraphicsProfile _selectedGraphicsProfile = GraphicsProfile.HiDef;
     private static GraphicsProfile _currentGraphicsProfile = _selectedGraphicsProfile;
     private static WorldPreparationState _worldPreparationState = WorldPreparationState.AwaitingData;
     private static UnifiedRandom _drawRand = new UnifiedRandom();
@@ -978,10 +_,6 @@
     public static Microsoft.Xna.Framework.Color imeCompositionStringColor = new Microsoft.Xna.Framework.Color(255, 240, 20);
     private static IMEPanelAnchor? imePanelAnchor = null;
     public static string motd = "";
-    public static bool toggleFullscreen;
-    public static int numDisplayModes;
-    public static int[] displayWidth = new int[99];
-    public static int[] displayHeight = new int[99];
     public static bool gameMenu = true;
     public static bool menuChat = false;
     public static bool menuBGChangedDay = false;
@@ -1117,7 +_,6 @@
     public static ParticleRenderer ParticleSystem_World_BehindPlayers = new ParticleRenderer();
     public static ParticleRenderer ParticleSystem_OverInventory = new ParticleRenderer();
     public static ParticleRenderer ParticleSystem_OverCursor = new ParticleRenderer();
-    private static WindowStateController _windowMover;
     public static AnchoredEntitiesCollection sittingManager;
     public static AnchoredEntitiesCollection sleepingManager;
     public static MinimapFrameManager MinimapFrameManagerInstance;
@@ -1275,7 +_,7 @@
     private static bool _blockFancyUIWhileLoading;
     private bool[] menuWide = new bool[100];
     public static float GamepadCursorAlpha = 0f;
-    private bool _needsMenuUIRecalculation;
+    public bool _needsMenuUIRecalculation;
     public static float MenuXMovement = 0f;
     public RejectionMenuInfo RejectionMenuInfo;
     private float _splashFrameCount;
@@ -1322,7 +_,7 @@
     private static TextSnippet[] _netplayStatusTextSnippets;
     public static int ladyBugRainBoost = 0;
     private static bool _canShowMeteorFall;
-    private static bool _isResizingAndRemakingTargets = false;
+    public static bool _isResizingAndRemakingTargets = false;
     public static bool CanUpdateGameplay { get; private set; }
 
     public static Matrix UIScaleMatrix => _uiScaleMatrix;
@@ -2900,7 +_,6 @@
         configuration.Clear();
         configuration.Put("ResetDefaultUIScale", false);
         configuration.Put("SmartCursorToggle", cSmartCursorModeIsToggleAndNotHold);
-        configuration.Put("MapEnabled", mapEnabled);
         configuration.Put("InvasionBarMode", invasionProgressMode);
         configuration.Put("AutoSave", autoSave);
         configuration.Put("AutoPause", autoPause);
@@ -2979,9 +_,6 @@
         configuration.Put("UIScale", _uiScaleWanted);
         configuration.Put("MapScale", MapScale);
         configuration.Put("FlashIconForEvents", Enum.GetName(typeof(GameNotificationType), _flashNotificationType));
-        configuration.Put("Display", _windowMover.ScreenDeviceName);
-        configuration.Put("DisplayScreen", _windowMover.ScreenDeviceName);
-        configuration.Put("ThrottleWhenInactive", ThrottleWhenInactive);
         configuration.Put("UnpinFromCore0", UnpinFromCore0);
         configuration.Put("DoorAutoOpeningMode", DoorOpeningHelper.PreferenceSettings);
         configuration.Put("HoverControlMode", Player.Settings.HoverControl);
@@ -3014,7 +_,7 @@
         }
     }
 
-    private static void TryPickingDefaultUIScale(float displayHeight)
+    public static void TryPickingDefaultUIScale(float displayHeight)
     {
         if (shouldSetDefaultUIScale)
         {
@@ -3057,46 +_,13 @@
             configuration.Get("WindowBorderless", ref screenBorderless);
         }
 
-        PendingBorderlessState = screenBorderless;
-        screenBorderlessPendingResizes = (screenBorderless ? 6 : 0);
-        if (Platform.IsWindows && !dedServ)
-        {
-            Form form = (Form)Control.FromHandle(instance.Window.Handle);
-            if (screenBorderless)
-            {
-                SetBorderlessFormStyle(form);
-            }
-            else if (screenMaximized)
-            {
-                form.FormBorderStyle = FormBorderStyle.Sizable;
-                form.WindowState = FormWindowState.Maximized;
-            }
-            else
-            {
-                form.FormBorderStyle = FormBorderStyle.Sizable;
-            }
-
-            form.BringToFront();
-        }
-
         int currentValue2 = graphics.PreferredBackBufferWidth;
         int currentValue3 = graphics.PreferredBackBufferHeight;
         configuration.Get("DisplayWidth", ref currentValue2);
         configuration.Get("DisplayHeight", ref currentValue3);
         LastLoadedResolution = new Microsoft.Xna.Framework.Point(currentValue2, currentValue3);
-        if (!startFullscreen)
-        {
-            if (PendingBorderlessState)
-            {
-                screenBorderlessPendingResizes = 1;
-            }
-
-            SetDisplayMode(currentValue2, currentValue3, fullscreen: false);
-            TryPickingDefaultUIScale(currentValue3);
-        }
 
         configuration.Get("SmartCursorToggle", ref cSmartCursorModeIsToggleAndNotHold);
-        configuration.Get("MapEnabled", ref mapEnabled);
         configuration.Get("InvasionBarMode", ref invasionProgressMode);
         configuration.Get("AutoSave", ref autoSave);
         configuration.Get("AutoPause", ref autoPause);
@@ -3141,34 +_,7 @@
             configuration.Get("GraphicsQuality", ref qaStyle);
             configuration.Get("BackgroundEnabled", ref BackgroundEnabled);
         }
-
-        if (configuration.GetAllKeys().Contains("FrameSkip"))
-        {
-            bool currentValue4 = false;
-            configuration.Get("FrameSkip", ref currentValue4);
-            if (!currentValue4)
-            {
-                FrameSkipMode = FrameSkipMode.Subtle;
-            }
-            else
-            {
-                FrameSkipMode = FrameSkipMode.On;
-            }
-        }
-
-        int currentValue5 = (int)FrameSkipMode;
-        configuration.Get("FrameSkipMode", ref currentValue5);
-        if (currentValue5 < 0)
-        {
-            currentValue5 = 0;
-        }
-
-        if (currentValue5 > 2)
-        {
-            currentValue5 = 2;
-        }
-
-        FrameSkipMode = (FrameSkipMode)currentValue5;
+        
         int currentValue6 = (int)Lighting.Mode;
         if (!flag)
         {
@@ -3317,18 +_,6 @@
 
         if (!flag)
         {
-            string screenDeviceName = configuration.Get("DisplayScreen", "");
-            _windowMover.TryMovingToScreen(screenDeviceName);
-            ThrottleWhenInactive = configuration.Get("ThrottleWhenInactive", defaultValue: true);
-            UnpinFromCore0 = configuration.Get("UnpinFromCore0", defaultValue: false);
-            if (UnpinFromCore0 && Platform.IsWindows)
-            {
-                WindowsPerformanceDiagnostics.UnpinFromCore0();
-            }
-        }
-
-        if (!flag)
-        {
             configuration.Get("Support4K", ref Support4K);
         }
 
@@ -3486,14 +_,7 @@
 
                 if (num >= 91 && binaryReader.ReadBoolean() && !dedServ && Platform.IsWindows)
                 {
-                    ((Form)Control.FromHandle(base.Window.Handle)).WindowState = FormWindowState.Maximized;
-                }
-
-                if (num >= 4)
-                {
-                    int width = binaryReader.ReadInt32();
-                    int height = binaryReader.ReadInt32();
-                    SetDisplayMode(width, height, flag);
+                    SDL3.SDL.SDL_MaximizeWindow(base.Window.Handle);
                 }
 
                 if (num >= 8)
@@ -3566,8 +_,6 @@
                 {
                     placementPreview = binaryReader.ReadBoolean();
                 }
-
-                SetFullScreen(flag);
             }
 
             binaryReader.Close();
@@ -5158,6 +_,8 @@
             graphics = new GraphicsDeviceManager(this as Game);
             base.Content.RootDirectory = "Content";
         }
+        base.Window.AllowUserResizing = true;
+        ClientLoader.WindowManager = new WindowManager(this as Game);
     }
 
     private static void SetDisplayMonitor()
@@ -5191,7 +_,7 @@
             }
             else
             {
-                _cachedTitle = Lang.GetRandomGameTitle();
+                _cachedTitle = "TerraAngel";
             }
 
             Platform.Get<IWindowService>().SetUnicodeTitle(base.Window, _cachedTitle);
@@ -5270,7 +_,6 @@
         SetTitle(initialSetup: true);
         lo = rand.Next(6);
         waterfallManager = new WaterfallManager();
-        _windowMover = new WindowStateController();
         sittingManager = new AnchoredEntitiesCollection();
         sleepingManager = new AnchoredEntitiesCollection();
         gameTips = new GameTipsDisplay(new GameTipsProvider());
@@ -5308,6 +_,7 @@
         LoadContent_TryEnteringHiDef();
         ClientInitialize();
         base.Initialize();
+        ClientLoader.WindowManager?.Init();
     }
 
     private void BindSettingsTo(Preferences preferences)
@@ -5316,7 +_,6 @@
         MinimapFrameManagerInstance.BindTo(preferences);
         BigBossProgressBar.BindTo(preferences);
         ResourceSetsManager.BindTo(preferences);
-        ChromaInitializer.BindTo(preferences);
         Terraria.Graphics.Effects.Filters.Scene.BindTo(preferences);
         if (SocialAPI.Cloud != null)
         {
@@ -5495,6 +_,7 @@
             SoundID.FillAccessMap();
             Star.SpawnStars();
         }
+        ClientLoader.Initialize(this);
     }
 
     private void Initialize_Entities()
@@ -9446,9 +_,7 @@
         {
             screenHeight = GraphicsAdapter.DefaultAdapter.CurrentDisplayMode.Height;
         }
-
-        UpdateDisplaySettings();
-        graphics.ApplyChanges();
+        
         if (Main.OnResolutionChanged != null)
         {
             Main.OnResolutionChanged(new Vector2(screenWidth, screenHeight));
@@ -9467,9 +_,6 @@
         _achievementAdvisor = new AchievementAdvisor();
         OpenRecent();
         UILinksInitializer.Load();
-        Chroma = new ChromaEngine();
-        ChromaPainter = new ChromaHotkeyPainter();
-        ChromaPainter.CollectBoundKeys();
         CacheSupportedDisplaySizes();
         if (autoJoin)
         {
@@ -9482,57 +_,10 @@
 
     private static void CacheSupportedDisplaySizes()
     {
-        numDisplayModes = 0;
-        CollectDisplayResolutionsFromAdapter(GraphicsAdapter.DefaultAdapter);
-        foreach (GraphicsAdapter adapter in GraphicsAdapter.Adapters)
-        {
-            if (adapter != GraphicsAdapter.DefaultAdapter)
-            {
-                CollectDisplayResolutionsFromAdapter(adapter);
-            }
-        }
-
-        if (numDisplayModes == 0)
-        {
-            RegisterDisplayResolution(minScreenW, minScreenH);
-        }
-    }
-
-    private static void CollectDisplayResolutionsFromAdapter(GraphicsAdapter adapter)
-    {
-        foreach (DisplayMode supportedDisplayMode in adapter.SupportedDisplayModes)
-        {
-            if (supportedDisplayMode.Width >= minScreenW && supportedDisplayMode.Width <= maxScreenW && supportedDisplayMode.Height >= minScreenH && supportedDisplayMode.Height <= maxScreenH && !IsModeOfSameResolutionRegistered(supportedDisplayMode))
-            {
-                RegisterDisplayResolution(supportedDisplayMode.Width, supportedDisplayMode.Height);
-            }
-        }
-    }
-
-    private static void RegisterDisplayResolution(int width, int height)
-    {
-        if (numDisplayModes >= displayWidth.Length)
-        {
-            Array.Resize(ref displayWidth, numDisplayModes * 2);
-            Array.Resize(ref displayHeight, numDisplayModes * 2);
-        }
-
-        displayWidth[numDisplayModes] = width;
-        displayHeight[numDisplayModes] = height;
-        numDisplayModes++;
-    }
-
-    private static bool IsModeOfSameResolutionRegistered(DisplayMode mode)
-    {
-        for (int i = 0; i < numDisplayModes; i++)
-        {
-            if (mode.Width == displayWidth[i] && mode.Height == displayHeight[i])
-            {
-                return true;
-            }
-        }
-
-        return false;
+        SDL3.SDL.SDL_GetDisplayBounds(SDL3.SDL.SDL_GetDisplayForWindow(Main.instance.Window.Handle), out SDL3.SDL.SDL_Rect bounds);
+        
+        Main.maxScreenW = bounds.w;
+        Main.maxScreenH = bounds.h;
     }
 
     public static void LoadTestLog(string logname)
@@ -9579,6 +_,7 @@
 
         Assets = base.Services.Get<IAssetRepository>();
         Assets.AssetLoadFailHandler = OnceFailedLoadingAnAsset;
+        base.Content.RootDirectory = ClientLoader.ContentFolder;
         IAssetRepository assets = Assets;
         assets.AssetWatcherValueUpdatedHandler = (AssetWatcherValueUpdated)Delegate.Combine(assets.AssetWatcherValueUpdatedHandler, new AssetWatcherValueUpdated(AssetWatcherValueUpdated));
         IAssetRepository assets2 = Assets;
@@ -9603,7 +_,6 @@
         AssetSourceController.UseResourcePacks(AssetInitializer.CreateResourcePackList(base.Services));
         LoadContent_Shaders();
         AssetInitializer.LoadSplashAssets();
-        ChromaInitializer.Load();
         _gameContentLoadProcess = LoadContent_Deferred();
         if (Setting_AssetFileWatcherEnabled)
         {
@@ -16016,6 +_,8 @@
                 }
         }
     }
+    
+    public static int CoinAnimationFrameCount = 0;
 
     public static void DoUpdate_AnimateItemIcons()
     {
@@ -16027,6 +_,10 @@
                 itemAnimations[num].Update();
             }
         }
+        
+        CoinAnimationFrameCount++;
+        if (CoinAnimationFrameCount > 6 * 8)
+            CoinAnimationFrameCount = 0;
     }
 
     public static void QueueMainThreadAction(Action action)
@@ -16126,8 +_,6 @@
         {
             UpdateAudio();
             GlobalTimeWrappedHourly = (float)(gameTime.TotalGameTime.TotalSeconds % 3600.0);
-            ChromaInitializer.UpdateEvents();
-            Chroma.Update(GlobalTimeWrappedHourly);
             return;
         }
 
@@ -16255,22 +_,10 @@
         {
             DoUpdate_AutoSave();
         }
+        MetricsTimer updateTimer = TimeMetrics.GetMetricsTimer("Main DoUpdate").Start();
 
         if (!dedServ)
         {
-            ChromaInitializer.UpdateEvents();
-            Chroma.Update(GlobalTimeWrappedHourly);
-            if (FrameSkipMode == FrameSkipMode.Off || FrameSkipMode == FrameSkipMode.Subtle)
-            {
-                base.IsFixedTimeStep = ThrottleWhenInactive && !base.IsActive;
-                graphics.SynchronizeWithVerticalRetrace = true;
-            }
-            else
-            {
-                base.IsFixedTimeStep = true;
-                graphics.SynchronizeWithVerticalRetrace = true;
-            }
-
             base.InactiveSleepTime = (ThrottleWhenInactive ? TimeSpan.FromMilliseconds(20.0) : TimeSpan.Zero);
             if (showSplash)
             {
@@ -16324,40 +_,23 @@
                 }
             }
 
-            if (FrameSkipMode == FrameSkipMode.Off || (FrameSkipMode == FrameSkipMode.Subtle && !improvedSubtleFrameSkip))
+            if (true)
             {
                 UpdateTimeAccumulator += gameTime.ElapsedGameTime.TotalSeconds;
                 if (UpdateTimeAccumulator < TARGET_FRAME_TIME)
                 {
-                    if (FrameSkipMode == FrameSkipMode.Subtle || CaptureInterface.CameraLock)
-                    {
-                        instance.SuppressDraw();
-                    }
-
                     return;
                 }
 
                 gameTime = new GameTime(gameTime.TotalGameTime, new TimeSpan((long)(TARGET_FRAME_TIME * 10000000.0)));
-            }
-
-            if (FrameSkipMode == FrameSkipMode.Off || FrameSkipMode == FrameSkipMode.Subtle)
-            {
                 UpdateTimeAccumulator -= TARGET_FRAME_TIME;
                 UpdateTimeAccumulator = Utils.Clamp(UpdateTimeAccumulator, 0.0, 3.0 * TARGET_FRAME_TIME);
-                if (UpdateTimeAccumulator > TARGET_FRAME_TIME && successiveSkippedDraws++ < 2)
-                {
-                    base.InactiveSleepTime = TimeSpan.Zero;
-                    instance.SuppressDraw();
-                }
-                else
-                {
-                    successiveSkippedDraws = 0;
-                }
             }
 
             uCount++;
             DebugLineDraw.Update();
             MouseOversClear();
+            ClientLoader.MainRenderer?.Update();
             PlayerInput.AllowExecutionOfGamepadInstructions = true;
             TryPlayingCreditsRoll();
             PlayerInput.SetZoom_UI();
@@ -16460,10 +_,7 @@
             hasFocus = base.IsActive || DebugOptions.noPause;
             if (Platform.IsWindows)
             {
-                Form form = Control.FromHandle(base.Window.Handle) as Form;
-                bool num3 = form.WindowState == FormWindowState.Minimized;
-                bool flag = Form.ActiveForm == form;
-                hasFocus |= flag;
+                bool num3 = (SDL3.SDL.SDL_GetWindowFlags(base.Window.Handle) & SDL3.SDL.SDL_WindowFlags.SDL_WINDOW_MINIMIZED) == SDL3.SDL.SDL_WindowFlags.SDL_WINDOW_MINIMIZED;
                 if (num3)
                 {
                     hasFocus = false;
@@ -16476,7 +_,7 @@
                 {
                     if (!Platform.IsOSX)
                     {
-                        base.IsMouseVisible = true;
+                        base.IsMouseVisible = TerraAngel.Hooks.MiscHooks.ShouldMouseBeVisible(true);
                     }
 
                     if (netMode != 2 && myPlayer >= 0)
@@ -16497,7 +_,7 @@
 
                 if (!Platform.IsOSX)
                 {
-                    base.IsMouseVisible = false;
+                    base.IsMouseVisible = TerraAngel.Hooks.MiscHooks.ShouldMouseBeVisible(false);
                 }
 
                 if (Platform.IsWindows && ReHideCursor)
@@ -16527,7 +_,6 @@
             DoUpdate_F8_ToggleNetDiagnostics();
             DoUpdate_F7_ToggleGraphicsDiagnostics();
             DoUpdate_F11_ToggleUI();
-            DoUpdate_AltEnter_ToggleFullscreen();
             DoDebugFunctions();
             DoUpdate_HandleInput();
             DoUpdate_HandleChat();
@@ -16638,7 +_,7 @@
             if ((double)screenPosition.Y < worldSurface * 16.0 + 16.0)
             {
                 Star.UpdateStars();
-                Cloud.UpdateClouds();
+                Cloud.UpdateClouds(gameTime);
             }
             else if (shimmerAlpha > 0f)
             {
@@ -16671,13 +_,13 @@
 
         if (netMode != 2)
         {
-            ChromaPainter.Update();
         }
 
         if (Main.OnTickForThirdPartySoftwareOnly != null)
         {
             Main.OnTickForThirdPartySoftwareOnly();
         }
+        updateTimer.Stop();
     }
 
     internal static void UpdateCreativeGameModeOverride()
@@ -17648,6 +_,7 @@
 
     private static void DoUpdate_Enter_ToggleChat()
     {
+        return;
         if (keyState.IsKeyDown(Microsoft.Xna.Framework.Input.Keys.Enter) && !keyState.IsKeyDown(Microsoft.Xna.Framework.Input.Keys.LeftAlt) && !keyState.IsKeyDown(Microsoft.Xna.Framework.Input.Keys.RightAlt) && hasFocus)
         {
             if (chatRelease && !drawingPlayerChat && !editSign && !editChest && (!gameMenu || menuChat) && !keyState.IsKeyDown(Microsoft.Xna.Framework.Input.Keys.Escape))
@@ -17667,6 +_,7 @@
 
     public static void OpenPlayerChat()
     {
+        return;
         if (CurrentInputTextTakerOverride == null)
         {
             drawingPlayerChat = true;
@@ -17676,6 +_,7 @@
 
     public static void ClosePlayerChat()
     {
+        return;
         drawingPlayerChat = false;
         PlayerInput.WritingText = false;
         player[myPlayer].releaseHook = false;
@@ -17684,6 +_,7 @@
 
     private static void DoUpdate_HandleChat()
     {
+        return;
         if (CurrentInputTextTakerOverride != null)
         {
             drawingPlayerChat = false;
@@ -17779,24 +_,6 @@
         keyState = Keyboard.GetState();
     }
 
-    private static void DoUpdate_AltEnter_ToggleFullscreen()
-    {
-        if ((keyState.IsKeyDown(Microsoft.Xna.Framework.Input.Keys.LeftAlt) || keyState.IsKeyDown(Microsoft.Xna.Framework.Input.Keys.RightAlt)) && keyState.IsKeyDown(Microsoft.Xna.Framework.Input.Keys.Enter) && hasFocus)
-        {
-            if (toggleFullscreen)
-            {
-                ToggleFullScreen();
-                chatRelease = false;
-            }
-
-            toggleFullscreen = false;
-        }
-        else
-        {
-            toggleFullscreen = true;
-        }
-    }
-
     private static void DoUpdate_F11_ToggleUI()
     {
         if (keyState.IsKeyDown(Microsoft.Xna.Framework.Input.Keys.F11))
@@ -20262,8 +_,11 @@
 
         return result;
     }
-
+    
     public static void MouseText_DrawItemTooltip_GetLinesInfo(Item item, ref int yoyoLogo, ref int researchLine, float oldKB, ref int numLines, string[] toolTipLine, Microsoft.Xna.Framework.Color[] lineColors)
+        => TerraAngel.Hooks.DrawHooks.GetLinesInfoHook(_MouseText_DrawItemTooltip_GetLinesInfo, item, ref yoyoLogo, ref researchLine, oldKB, ref numLines, toolTipLine, lineColors);
+
+    public static void _MouseText_DrawItemTooltip_GetLinesInfo(Item item, ref int yoyoLogo, ref int researchLine, float oldKB, ref int numLines, string[] toolTipLine, Microsoft.Xna.Framework.Color[] lineColors)
     {
         toolTipLine[0] = item.HoverName;
         Microsoft.Xna.Framework.Color color = new Microsoft.Xna.Framework.Color(190, 120, 120);
@@ -20374,7 +_,7 @@
                 {
                     toolTipLine[numLines] = Lang.tip[13].Value;
                 }
-
+                if (ClientConfig.Settings.ShowDetailedTooltips) toolTipLine[numLines] += $" [{item.useAnimation}/{(item.useAnimation / 60f):F2}s{(item.useAnimation != item.useTime ? $" {item.useTime}/{(item.useTime / 60f):F2}s" : "")}]";
                 numLines++;
             }
 
@@ -20430,7 +_,7 @@
             {
                 toolTipLine[numLines] = Lang.tip[22].Value;
             }
-
+            if (ClientConfig.Settings.ShowDetailedTooltips) toolTipLine[numLines] += $" [{num5:F2}]";
             numLines++;
         }
 
@@ -21584,6 +_,9 @@
 
     protected void DrawGoreBehind()
     {
+        if (OptimizationTool.OptimizationToolCache?.DisableGore ?? false)
+            return;
+        
         for (int i = 0; i < 600; i++)
         {
             if (!gore[i].active || gore[i].type <= 0)
@@ -21617,6 +_,9 @@
 
     protected void DrawGore()
     {
+        if (OptimizationTool.OptimizationToolCache?.DisableGore ?? false)
+            return;
+        
         TimeLogger.StartTimestamp fromTimestamp = TimeLogger.Start();
         drawBackGore = false;
         for (int i = 0; i < 600; i++)
@@ -22072,18 +_,22 @@
 
     protected void DrawPlayers_BehindNPCs()
     {
+        Main.screenPosition.Y = floatingCameraY;
         TimeLogger.StartTimestamp fromTimestamp = TimeLogger.Start();
         PotionOfReturnRenderer.DrawPlayers(Camera, _playersThatDrawBehindNPCs.Where((Player p) => p.PotionOfReturnOriginalUsePosition.HasValue));
         PlayerRenderer.DrawPlayers(Camera, _playersThatDrawBehindNPCs);
         TimeLogger.Players.AddTime(fromTimestamp);
+        Main.screenPosition.Y = (int)Main.screenPosition.Y;
     }
 
     protected void DrawPlayers_AfterProjectiles()
     {
+        Main.screenPosition.Y = floatingCameraY;
         TimeLogger.StartTimestamp fromTimestamp = TimeLogger.Start();
         PotionOfReturnRenderer.DrawPlayers(Camera, _playersThatDrawAfterProjectiles.Where((Player p) => p.PotionOfReturnOriginalUsePosition.HasValue));
         PlayerRenderer.DrawPlayers(Camera, _playersThatDrawAfterProjectiles);
         TimeLogger.Players.AddTime(fromTimestamp);
+        Main.screenPosition.Y = (int)Main.screenPosition.Y;
     }
 
     protected void DrawElderEye(SpriteBatch spriteBatch, Vector2 worldPosition, float opacity, float scale, int frameNumber, Microsoft.Xna.Framework.Color passedColor)
@@ -26700,7 +_,7 @@
                     float hue = ((float)i + 5f) / 10f;
                     float num10 = 200f;
                     float num11 = (float)timeForVisualEffects / 60f;
-                    Vector3 vector2 = Vector3.Transform(matrix: Matrix.CreateRotationX((num11 - 0.3f + (float)i * 0.1f) * 0.7f * ((float)Math.PI * 2f)) * Matrix.CreateRotationY((num11 - 0.8f + (float)i * 0.3f) * 0.7f * ((float)Math.PI * 2f)) * Matrix.CreateRotationZ((num11 + (float)i * 0.5f) * 0.1f * ((float)Math.PI * 2f)), position: Vector3.Forward);
+                    Vector3 vector2 = Vector3.Transform(matrix: Matrix.CreateRotationX((num11 - 0.3f + (float)i * 0.1f) * 0.7f * ((float)Math.PI * 2f)) * Matrix.CreateRotationY((num11 - 0.8f + (float)i * 0.3f) * 0.7f * ((float)Math.PI * 2f)) * Matrix.CreateRotationZ((num11 + (float)i * 0.5f) * 0.1f * ((float)Math.PI * 2f)), position: -Vector3.UnitZ);
                     num10 += Utils.GetLerpValue(-1f, 1f, vector2.Z, clamped: true) * 150f;
                     Vector2 spinningpoint = new Vector2(vector2.X, vector2.Y) * num10 * num7;
                     float lerpValue = Utils.GetLerpValue(90f, 0f, rCurrentNPC.ai[1], clamped: true);
@@ -32010,7 +_,7 @@
                         float num231 = 0.9f + num229 * 0.8f;
                         num231 *= num231;
                         num231 *= 0.8f;
-                        Vector2 position8 = Vector2.SmoothStep(center2, value49, num229);
+                        Vector2 position8 = VectorExtensions.SmoothStep(center2, value49, num229);
                         Microsoft.Xna.Framework.Rectangle rectangle8 = value48.Frame(1, 7, 0, (int)(num229 * 7f));
                         EntitySpriteDraw(value48, position8, rectangle8, transparent, proj.rotation + (float)Math.PI * 2f * (num229 + GlobalTimeWrappedHourly * 1.2f) * 0.2f + (float)num230 * ((float)Math.PI * 2f / 5f), rectangle8.Size() / 2f, num231, SpriteEffects.None);
                     }
@@ -39265,8 +_,7 @@
                     {
                         int num = item.type - 71;
                         texture = TextureAssets.Coin[num].Value;
-                        DrawItem_AnimateSlot(slot, 6, 8);
-                        frame = (glowmaskFrame = _coinOnWorldAnimation.GetFrame(texture, itemFrameCounter[slot]));
+                        frame = (glowmaskFrame = _coinOnWorldAnimation.GetFrame(texture, CoinAnimationFrameCount));
                         return;
                     }
 
@@ -39565,6 +_,9 @@
 
     internal void DrawDust()
     {
+        if (OptimizationTool.OptimizationToolCache?.DisableDust ?? false)
+            return;
+        
         TimeLogger.StartTimestamp fromTimestamp = TimeLogger.Start();
         Microsoft.Xna.Framework.Rectangle rectangle = new Microsoft.Xna.Framework.Rectangle((int)screenPosition.X - 500, (int)screenPosition.Y - 50, screenWidth + 1000, screenHeight + 100);
         rectangle = new Microsoft.Xna.Framework.Rectangle((int)screenPosition.X - 1000, (int)screenPosition.Y - 1050, screenWidth + 2000, screenHeight + 2100);
@@ -41731,6 +_,7 @@
 
     public void DrawIMEPanel()
     {
+        return;
         if (!imePanelAnchor.HasValue || !Platform.Get<IImeService>().IsCandidateListVisible)
         {
             return;
@@ -41821,6 +_,7 @@
 
     public void DrawPlayerChat()
     {
+        return;
         TimeLogger.StartTimestamp fromTimestamp = TimeLogger.Start();
         TextSnippet[] array = null;
         if (drawingPlayerChat)
@@ -46245,6 +_,7 @@
 
     private static void DrawInterface_41_InterfaceLogic4()
     {
+        TerraAngel.Hooks.MiscHooks.LastCursorOverride = cursorOverride;
         if (mouseRight)
         {
             npcChatRelease = false;
@@ -48295,7 +_,7 @@
                     Tile tileSafely = Framing.GetTileSafely(bestOrePosition);
                     if (tileSafely.active())
                     {
-                        MapHelper.GetTileBaseOption(bestOrePosition.X, bestOrePosition.Y, tileSafely.type, tileSafely, ref baseOption);
+                        MapHelper.GetTileBaseOption(bestOrePosition.X, bestOrePosition.Y, tileSafely.type, ref tileSafely.RefData, ref baseOption);
                         num10 = tileSafely.type;
                         if (baseOption >= 13 || TileID.Sets.BasicChest[num10] || TileID.Sets.BasicChestFake[num10])
                         {
@@ -49282,7 +_,6 @@
 
     private static void TryDisposingEverything()
     {
-        ChromaInitializer.DisableAllDeviceGroups();
         CaptureManager.Instance.Dispose();
         audioSystem.Dispose();
     }
@@ -49413,6 +_,12 @@
 
     public static void DrawCursor(Vector2 bonus, bool smart = false)
     {
+        if (!Main.instance.IsActive)
+            return;
+        if (ClientLoader.MainRenderer is not null && (ImGui.GetIO().WantCaptureMouse || ImGui.GetIO().WantCaptureKeyboard))
+        {
+            return;
+        }
         if (gameMenu && alreadyGrabbingSunOrMoon)
         {
             return;
@@ -49502,6 +_,12 @@
 
     public static Vector2 DrawThickCursor(bool smart = false)
     {
+        if (!Main.instance.IsActive)
+            return Vector2.Zero;
+        if (ClientLoader.MainRenderer is not null && (ImGui.GetIO().WantCaptureMouse || ImGui.GetIO().WantCaptureKeyboard))
+        {
+            return Vector2.Zero;
+        }
         if (ThickMouse)
         {
             bool showGamepadCursor = PlayerInput.SettingsForUI.ShowGamepadCursor;
@@ -49682,7 +_,7 @@
         }
 
         screenPosition.Y = (float)(worldSurface * 16.0 - (double)screenHeight);
-        MenuXMovement = 4f;
+        MenuXMovement = 4f * 60f * (float)gameTime.ElapsedGameTime.TotalSeconds;
         if (alreadyGrabbingSunOrMoon)
         {
             playOldTile = true;
@@ -49704,17 +_,17 @@
         }
 
         Star.UpdateStars();
-        Cloud.UpdateClouds();
+        Cloud.UpdateClouds(gameTime);
         DrawFPS();
         background = 0;
         byte b = (byte)((255 + tileColor.R * 2) / 3);
         Microsoft.Xna.Framework.Color color = new Microsoft.Xna.Framework.Color(b, b, b, 255);
         if (WorldGen.remixWorldGen)
         {
-            logoRotation += logoRotationSpeed * 4E-05f;
+            logoRotation += logoRotationSpeed * 4E-05f * 60f * (float)gameTime.ElapsedGameTime.TotalSeconds;
             if ((double)logoRotation < 3.04)
             {
-                logoRotation += logoRotationSpeed * 0.0016f;
+                logoRotation += logoRotationSpeed * 0.0016f * 60f * (float)gameTime.ElapsedGameTime.TotalSeconds;
                 if (logoRotationSpeed < 0f)
                 {
                     logoRotationSpeed = 0f;
@@ -49739,7 +_,7 @@
                 logoRotationSpeed -= 1f;
             }
 
-            logoScale += logoScaleSpeed * 9E-05f;
+            logoScale += logoScaleSpeed * 9E-05f * 60f * (float)gameTime.ElapsedGameTime.TotalSeconds;
             if (logoScale > 1f)
             {
                 logoScaleDirection = -1f;
@@ -49760,7 +_,7 @@
         }
         else if (WorldGen.drunkWorldGen && !WorldGen.notTheBees)
         {
-            logoRotation += logoRotationSpeed * 4E-06f;
+            logoRotation += logoRotationSpeed * 4E-06f * 60f * (float)gameTime.ElapsedGameTime.TotalSeconds;
             if (logoRotationSpeed > 0f)
             {
                 logoRotationSpeed += 1500f;
@@ -49791,14 +_,14 @@
 
             if ((double)logoRotation > 0.09)
             {
-                logoRotation += logoRotationSpeed * 0.0016f;
+                logoRotation += logoRotationSpeed * 0.0016f * 60f * (float)gameTime.ElapsedGameTime.TotalSeconds;
                 if (logoRotationSpeed > 0f)
                 {
                     logoRotationSpeed = 0f;
                 }
             }
 
-            logoRotation += logoRotationSpeed * 4E-06f;
+            logoRotation += logoRotationSpeed * 4E-06f * 60f * (float)gameTime.ElapsedGameTime.TotalSeconds;
             if ((double)logoRotation > 0.08)
             {
                 logoRotationDirection = -1f;
@@ -49817,7 +_,7 @@
                 logoRotationSpeed -= 1f;
             }
 
-            logoScale += logoScaleSpeed * 9E-06f;
+            logoScale += logoScaleSpeed * 9E-06f * 60f * (float)gameTime.ElapsedGameTime.TotalSeconds;
             if ((double)logoScale > 1.35)
             {
                 logoScaleDirection = -1f;
@@ -50507,6 +_,26 @@
             }
 
             num12++;
+            num5++;
+            array9[num12] = GetString("TerraAngel Settings");
+            if (selectedMenu == num12)
+            {
+                SoundEngine.PlaySound(10);
+                menuMode = 888;
+                MenuUI.SetState(ClientLoader.ConfigUI!);
+            }
+            
+            num12++;
+            num5++;
+            array9[num12] = GetString("TerraAngel Plugins");
+            if (selectedMenu == num12)
+            {
+                SoundEngine.PlaySound(10);
+                menuMode = 888;
+                MenuUI.SetState(ClientLoader.PluginUI!);
+            }
+
+            num12++;
             array9[num12] = Lang.menu[14].Value;
             if (selectedMenu == num12)
             {
@@ -51595,14 +_,6 @@
                 }
 
                 num26++;
-                array9[num26] = Lang.menu[(int)(247 + FrameSkipMode)].Value;
-                if (selectedMenu == num26)
-                {
-                    SoundEngine.PlaySound(12);
-                    CycleFrameSkipMode();
-                }
-
-                num26++;
                 array9[num26] = Language.GetTextValue("UI.LightMode_" + Lighting.Mode);
                 if (selectedMenu == num26)
                 {
@@ -51750,86 +_,9 @@
             }
             else if (menuMode == 111)
             {
-                for (int num30 = 0; num30 < 9; num30++)
-                {
-                    array7[num30] = 0.85f;
-                }
-
-                num2 = 210;
-                num4 = 55;
-                int num31 = 0;
-                array9[num31] = Lang.menu[73].Value + ": " + PendingResolutionWidth + "x" + PendingResolutionHeight;
-                if (selectedMenu == num31)
-                {
-                    SoundEngine.PlaySound(12);
-                    int num32 = 0;
-                    for (int num33 = 0; num33 < numDisplayModes; num33++)
-                    {
-                        if (displayWidth[num33] == PendingResolutionWidth && displayHeight[num33] == PendingResolutionHeight)
-                        {
-                            num32 = num33;
-                            break;
-                        }
-                    }
-
-                    num32 = (num32 + 1) % numDisplayModes;
-                    PendingResolutionWidth = displayWidth[num32];
-                    PendingResolutionHeight = displayHeight[num32];
-                }
-
-                num31++;
-                if (IsBorderlessDisplayAvailable())
-                {
-                    array9[num31] = Lang.menu[PendingBorderlessState ? 245 : 246].Value;
-                    if (selectedMenu == num31)
-                    {
-                        SoundEngine.PlaySound(12);
-                        PendingBorderlessState = !PendingBorderlessState;
-                    }
-
-                    num31++;
-                }
-
-                array9[num31] = (graphics.IsFullScreen ? Lang.menu[49].Value : Lang.menu[50].Value);
-                if (selectedMenu == num31)
-                {
-                    action = (Action)Delegate.Combine(action, new Action(ToggleFullScreen));
-                }
-
-                num31++;
-                array4[num31] = 100;
-                array9[num31] = Lang.menu[134].Value;
-                if (selectedMenu == num31)
-                {
-                    if (graphics.IsFullScreen || PendingBorderlessState != screenBorderless || PendingResolutionWidth != screenWidth || PendingResolutionHeight != screenHeight)
-                    {
-                        action = (Action)Delegate.Combine(action, (Action)delegate
-                        {
-                            screenBorderless = PendingBorderlessState;
-                            screenBorderlessPendingResizes = (screenBorderless ? 6 : 0);
-                            SetResolution(PendingResolutionWidth, PendingResolutionHeight);
-                        });
-                    }
-
-                    SoundEngine.PlaySound(11);
-                    menuMode = 1111;
-                }
-
-                num31++;
-                array9[num31] = Lang.menu[5].Value;
-                array4[num31] = 100;
-                if (selectedMenu == num31 || flag5)
-                {
-                    flag5 = false;
-                    PendingResolutionWidth = graphics.PreferredBackBufferWidth;
-                    PendingResolutionHeight = graphics.PreferredBackBufferHeight;
-                    PendingBorderlessState = screenBorderless;
-                    menuMode = 1111;
-                    SoundEngine.PlaySound(11);
-                }
-
-                num31++;
-                num5 = num31;
+                SoundEngine.PlaySound(10);
+                menuMode = 888;
+                MenuUI.SetState(ClientLoader.GraphicsUI!);
             }
             else if (menuMode == 1125)
             {
@@ -53681,19 +_,7 @@
 
         action?.Invoke();
     }
-
-    public static void CycleFrameSkipMode()
-    {
-        int frameSkipMode = (int)FrameSkipMode;
-        frameSkipMode++;
-        if (frameSkipMode < 0 || frameSkipMode > 2)
-        {
-            frameSkipMode = 0;
-        }
-
-        FrameSkipMode = (FrameSkipMode)frameSkipMode;
-    }
-
+    
     private static void OnSubmitServerPasswordFromRequest(string passwordCandidate)
     {
         Netplay.ServerPassword = passwordCandidate;
@@ -54075,48 +_,6 @@
         }
     }
 
-    private static bool IsBorderlessDisplayAvailable()
-    {
-        bool result = false;
-        if (Platform.IsWindows)
-        {
-            result = true;
-        }
-
-        return result;
-    }
-
-    private static void SetDisplayModeAsBorderless(ref int width, ref int height, Form form)
-    {
-        if (screenBorderless && !graphics.IsFullScreen && screenBorderlessPendingResizes > 0)
-        {
-            screenBorderlessPendingResizes--;
-            System.Drawing.Rectangle bounds = Screen.FromPoint(form.Location).Bounds;
-            width = bounds.Width;
-            height = bounds.Height;
-            TryPickingDefaultUIScale(height);
-        }
-    }
-
-    private static void ApplyBorderlessResolution(Form form)
-    {
-        if (screenBorderlessPendingResizes > 0)
-        {
-            screenBorderlessPendingResizes--;
-            System.Drawing.Rectangle bounds = Screen.FromPoint(form.Location).Bounds;
-            form.Location = new System.Drawing.Point(bounds.X, bounds.Y);
-            form.FormBorderStyle = FormBorderStyle.None;
-            form.Width = bounds.Width;
-            form.Height = bounds.Height;
-        }
-    }
-
-    private static void SetBorderlessFormStyle(Form form)
-    {
-        form.Location = new System.Drawing.Point(0, 0);
-        form.FormBorderStyle = FormBorderStyle.None;
-    }
-
     public static void OpenCharacterSelectUI()
     {
         menuMode = 888;
@@ -54631,7 +_,9 @@
             return;
         }
 
+        MetricsTimer backgroundTimer = TimeMetrics.GetMetricsTimer("Draw Background");
         TimeLogger.StartTimestamp fromTimestamp = TimeLogger.Start();
+        backgroundTimer.Start();
         tileBatch.Begin();
         Array.Clear(_drawbackground_colorSlices, 0, _drawbackground_colorSlices.Length);
         double num2 = maxTilesY - 330;
@@ -55326,11 +_,6 @@
                             continue;
                         }
 
-                        if (tile[num4, num5] == null)
-                        {
-                            tile[num4, num5] = new Tile();
-                        }
-
                         if (localShimmerAlpha == 0f && (color.R > 0 || color.G > 0 || color.B > 0))
                         {
                             if (!drawToScreen)
@@ -55560,10 +_,6 @@
                             if (WorldGen.InWorld(num15, num16))
                             {
                                 Microsoft.Xna.Framework.Color color9 = Lighting.GetColor(num15, num16);
-                                if (tile[num15, num16] == null)
-                                {
-                                    tile[num15, num16] = new Tile();
-                                }
 
                                 if (color9.R > 0 || color9.G > 0 || color9.B > 0)
                                 {
@@ -56377,10 +_,6 @@
                             int num23 = (int)(((float)(bgStartX + num3 * n + num20 * 16 + 8) + screenPosition.X) / 16f);
                             int num24 = (int)((num22 + screenPosition.Y) / 16f);
                             Microsoft.Xna.Framework.Color color3 = Lighting.GetColor(num23, num24);
-                            if (tile[num23, num24] == null)
-                            {
-                                tile[num23, num24] = new Tile();
-                            }
 
                             if (color3.R > 0 || color3.G > 0 || color3.B > 0)
                             {
@@ -56593,10 +_,6 @@
                                 int num36 = (int)(((float)(bgStartX + num3 * num31 + num33 * 16 + 8) + screenPosition.X) / 16f);
                                 int num37 = (int)((num35 + screenPosition.Y) / 16f);
                                 Microsoft.Xna.Framework.Color color11 = Lighting.GetColor(num36, num37);
-                                if (tile[num36, num37] == null)
-                                {
-                                    tile[num36, num37] = new Tile();
-                                }
 
                                 if (color11.R > 0 || color11.G > 0 || color11.B > 0)
                                 {
@@ -57121,23 +_,8 @@
 
     private static bool ShouldDrawBackgroundTileAt(int i, int j)
     {
-        if (tile[i, j] == null)
-        {
-            tile[i, j] = new Tile();
-        }
-
         if (caveParallax != 0f)
         {
-            if (tile[i - 1, j] == null)
-            {
-                tile[i - 1, j] = new Tile();
-            }
-
-            if (tile[i + 1, j] == null)
-            {
-                tile[i + 1, j] = new Tile();
-            }
-
             if (WallLightAt(i, j) || WallLightAt(i - 1, j) || WallLightAt(i + 1, j))
             {
                 return true;
@@ -57192,6 +_,7 @@
 
     protected void RenderBackground()
     {
+        if (!Main.instance.IsActive && netMode == 0) return;
         TimeLogger.StartTimestamp fromTimestamp = TimeLogger.Start();
         spriteBatch.Begin();
         if (ignoreErrors)
@@ -57349,7 +_,7 @@
 
         if (mapFullscreen)
         {
-            if (mouseLeft && base.IsActive && !CaptureManager.Instance.UsingMap)
+            if (mouseLeft && base.IsActive && !CaptureManager.Instance.UsingMap && !ToolManager.GetTool<MapScreenshotTool>().SelectingArea)
             {
                 if (mouseLeftRelease)
                 {
@@ -58484,6 +_,10 @@
 
     private static void DrawMapFullscreenBackground(Vector2 screenPosition, int screenWidth, int screenHeight)
     {
+        if (!WorldGen.InWorld((int)(player[myPlayer].Center.X / 16f), (int)(player[myPlayer].Center.Y / 16f)))
+        {
+            return;
+        }
         Asset<Texture2D> asset = TextureAssets.MapBGs[0];
         int num = -1;
         Microsoft.Xna.Framework.Color color = Microsoft.Xna.Framework.Color.White;
@@ -59435,6 +_,7 @@
 
     protected void RenderTiles()
     {
+        MetricsTimer tileTimer = TimeMetrics.GetMetricsTimer("Render Tiles").Start();
         TimeLogger.StartTimestamp fromTimestamp = TimeLogger.Start();
         try
         {
@@ -59455,6 +_,7 @@
         }
 
         TimeLogger.RenderSolidTiles.AddTime(fromTimestamp);
+        tileTimer.Stop();
     }
 
     protected void RenderTiles2()
@@ -59483,6 +_,7 @@
 
     protected void RenderWater()
     {
+        if (!Main.instance.IsActive && netMode == 0) return;
         TimeLogger.StartTimestamp fromTimestamp = TimeLogger.Start();
         spriteBatch.Begin();
         tileBatch.Begin();
@@ -59726,11 +_,6 @@
         {
             for (int j = num7 - 2; j < num8 + 2; j++)
             {
-                if (tile[j, i] == null)
-                {
-                    tile[j, i] = new Tile();
-                }
-
                 if (tile[j, i].liquid <= 0 || (tile[j, i].nactive() && tileSolid[tile[j, i].type] && !tileSolidTop[tile[j, i].type]) || !(Lighting.Brightness(j, i) > 0f || bg))
                 {
                     continue;
@@ -60124,6 +_,7 @@
 
     protected void DrawBlack(bool intoRenderTargets = false, bool force = false)
     {
+        if (LightingModifierTool.LightingModifierToolCache?.FullBright ?? false) return;
         if (shimmerAlpha == 1f)
         {
             return;
@@ -60184,11 +_,6 @@
                         return;
                     }
 
-                    if (Main.tile[j, i] == null)
-                    {
-                        Main.tile[j, i] = new Tile();
-                    }
-
                     Tile tile = Main.tile[j, i];
                     float num4 = Lighting.Brightness(j, i);
                     num4 = (float)Math.Floor(num4 * 255f) / 255f;
@@ -60360,11 +_,10 @@
         }
     }
 
-    protected void InitTargets()
+    public void InitTargets()
     {
         if (!PreventUpdatingTargets)
         {
-            UpdateDisplaySettings();
         }
 
         ReleaseTargets();
@@ -64204,10 +_,17 @@
     {
         if (!_isDrawingOrUpdating && IsGraphicsDeviceAvailable)
         {
+            ClientLoader.MainRenderer?.PreUpdate();
             _isDrawingOrUpdating = true;
             DetailedFPS.Begin(DetailedFPS.OperationCategory.Draw);
             EnsureRenderTargetContent();
+            MetricsTimer drawTimer = TimeMetrics.GetMetricsTimer("Main DoDraw").Start();
             DoDraw(gameTime);
+            drawTimer.Stop();
+            float y = Main.screenPosition.Y;
+            Main.screenPosition.Y = Main.floatingCameraY;
+            ClientLoader.MainRenderer?.Render();
+            Main.screenPosition.Y = y;
             if (Main.OnPostDraw != null)
             {
                 Main.OnPostDraw(gameTime);
@@ -64231,40 +_,10 @@
             NewRuntimeMethods.GC_Collect(0, GCCollectionMode.Forced, blocking: false);
         }
 
-        bool flag = false;
-        if (Program.IsMono)
-        {
-            flag = true;
-        }
-
-        if (FrameSkipMode == FrameSkipMode.Subtle && improvedSubtleFrameSkip)
-        {
-            while (true)
-            {
-                long num = presentTimestamp;
-                presentTimestamp = Stopwatch.GetTimestamp();
-                UpdateTimeAccumulator += Utils.SWTicksToTimeSpan(presentTimestamp - num).TotalSeconds;
-                if (UpdateTimeAccumulator >= TARGET_FRAME_TIME * 599.0 / 600.0)
-                {
-                    break;
-                }
-
-                DetailedFPS.Begin(DetailedFPS.OperationCategory.Idle);
-                if (!flag && UpdateTimeAccumulator < TARGET_FRAME_TIME * 0.9)
-                {
-                    flag = true;
-                    NewRuntimeMethods.GC_Collect(2, GCCollectionMode.Optimized, blocking: false);
-                }
-            }
-        }
+        // TerraAngel: Removed spin-wait loop that coupled draw FPS to update FPS
+        // Draw FPS is now decoupled from update FPS (updates run at 60 FPS, draws run uncapped or per WindowManager settings)
 
         DetailedFPS.Begin(DetailedFPS.OperationCategory.Present);
-        if (FrameSkipMode == FrameSkipMode.Subtle && improvedSubtleFrameSkip && !flag && DetailedFPS.CurrentFrameTime.TotalSeconds < TARGET_FRAME_TIME * 0.9 && DetailedFPS.VsyncAppearsActive())
-        {
-            flag = true;
-            NewRuntimeMethods.GC_Collect(2, GCCollectionMode.Optimized, blocking: false);
-        }
-
         base.EndDraw();
         DetailedFPS.End();
         DetailedFPS.StartNextFrame();
@@ -64272,6 +_,8 @@
 
     private void DoDraw(GameTime gameTime)
     {
+        ClientLoader.WindowManager!.Update();
+        
         if (showSplash)
         {
             TimeLogger.StartTimestamp fromTimestamp = TimeLogger.Start();
@@ -64347,7 +_,6 @@
 
         if (!dedServ)
         {
-            UpdateDisplaySettings();
             if (Main.OnPreDraw != null)
             {
                 Main.OnPreDraw(gameTime);
@@ -64413,7 +_,7 @@
         }
 
         ClearHoverItem();
-        DoDraw_UpdateCameraPosition();
+        TerraAngel.Hooks.DrawHooks.UpdateCameraHook(DoDraw_UpdateCameraPosition);
         Cloud.UpdateCloudParallax();
         sunCircle += 0.01f;
         if ((double)sunCircle > 6.285)
@@ -65150,7 +_,7 @@
         {
             TimeLogger.StartTimestamp fromTimestamp15 = TimeLogger.Start();
             PlayerInput.SetZoom_UI();
-            spriteBatch.Begin(SpriteSortMode.Deferred, BlendState.AlphaBlend, DefaultSamplerState, null, null, null, UIScaleMatrix);
+            spriteBatch.Begin(SpriteSortMode.Deferred, BlendState.AlphaBlend, SamplerState.LinearClamp, null, null, null, UIScaleMatrix);
             TimeLogger.Draw();
             spriteBatch.End();
             TimeLogger.DrawTimeLogger.AddTime(fromTimestamp15);
@@ -65310,10 +_,12 @@
         }
 
         instance.CameraModifiers.ApplyTo(ref screenPosition);
+        ClampScreenPositionToWorld();
+        floatingCameraY = screenPosition.Y;
         screenPosition.X = (int)screenPosition.X;
         screenPosition.Y = (int)screenPosition.Y;
-        ClampScreenPositionToWorld();
     }
+    public static float floatingCameraY;
 
     public static void DebugCameraPan(bool left, bool right, bool up, bool down)
     {
@@ -65496,7 +_,7 @@
         targetPan = vector * Camera.ScaledSize / 2f * num;
         return true;
     }
-
+    
     public static bool IsItDay()
     {
         if (remixWorld)
@@ -65948,7 +_,7 @@
                 _oldNetplayStatusText = text;
             }
 
-            Vector2 position = new Vector2(628f - ChatManager.GetStringSize(FontAssets.MouseText.Value, _netplayStatusTextSnippets, Vector2.One).X * 0.5f + (float)(screenWidth - 800), 84f);
+            Vector2 position = new Vector2(628f - MathF.Floor(ChatManager.GetStringSize(FontAssets.MouseText.Value, _netplayStatusTextSnippets, Vector2.One).X * 0.5f) + (float)(screenWidth - 800), 84f);
             int hoveredSnippet;
             if (Netplay.Connection.StatusTextHasShadows)
             {
@@ -67543,14 +_,12 @@
 
     public static void NewText(string newText, byte R = byte.MaxValue, byte G = byte.MaxValue, byte B = byte.MaxValue)
     {
-        chatMonitor.NewText(newText, R, G, B);
-        SoundEngine.PlaySound(12);
+        ClientLoader.Chat.WriteLine(newText, new Microsoft.Xna.Framework.Color(R, G, B, 255));
     }
 
     public static void NewTextMultiline(string text, bool force = false, Microsoft.Xna.Framework.Color c = default(Microsoft.Xna.Framework.Color), int WidthLimit = -1)
     {
-        chatMonitor.NewTextMultiline(text, force, c, WidthLimit);
-        SoundEngine.PlaySound(12);
+        ClientLoader.Chat.WriteLine(text, c);
     }
 
     public static void StopRain(bool instant = false)
@@ -69467,7 +_,9 @@
             }
             else
             {
+                SoundEngine.PlaySound(10);
-                menuMode = 13;
+                menuMode = 888;
+                MenuUI.SetState(ClientLoader.MultiplayerJoinUI!);
                 clrInput();
             }
         }
@@ -69480,227 +_,9 @@
         }
     }
 
-    public static void ToggleFullScreen()
-    {
-        SetFullScreen(!graphics.IsFullScreen);
-    }
-
-    public static void SetFullScreen(bool fullscreen)
-    {
-        SetDisplayMode(PendingResolutionWidth, PendingResolutionHeight, fullscreen);
-    }
-
-    public static void SetResolution(int width, int height)
-    {
-        SetDisplayMode(width, height, graphics.IsFullScreen);
-    }
-
-    public static void SetDisplayMode(int width, int height, bool fullscreen)
-    {
-        bool flag = false;
-        Form form = null;
-        if (Platform.IsWindows)
-        {
-            form = (Form)Control.FromHandle(instance.Window.Handle);
-            screenMaximized = form.WindowState == FormWindowState.Maximized;
-            if (screenBorderless && screenMaximized && !graphics.IsFullScreen)
-            {
-                screenMaximized = false;
-                form.WindowState = FormWindowState.Normal;
-            }
-
-            flag = form.FormBorderStyle == FormBorderStyle.None;
-        }
-        else
-        {
-            screenMaximized = false;
-        }
-
-        bool flag2 = false;
-        int num3;
-        int num4;
-        if (screenBorderless || screenMaximized || graphics.IsFullScreen || fullscreen)
-        {
-            bool flag3 = false;
-            if (PlayerInput.SteamDeckIsUsed)
-            {
-                flag3 = true;
-                if (!fullscreen && !graphics.IsFullScreen)
-                {
-                    width = 1280;
-                    height = 800;
-                    TryPickingDefaultUIScale(800f);
-                }
-            }
-
-            if (Platform.IsWindows)
-            {
-                form.MinimumSize = new Size(0, 0);
-                if (!fullscreen && !flag3)
-                {
-                    SetDisplayModeAsBorderless(ref width, ref height, form);
-                }
-            }
-
-            if (width > maxScreenW)
-            {
-                float num = (float)height / (float)width;
-                width = maxScreenW;
-                height = (int)(num * (float)width);
-            }
-
-            if (height > maxScreenH)
-            {
-                float num2 = (float)width / (float)height;
-                height = maxScreenH;
-                width = (int)(num2 * (float)height);
-            }
-
-            PlayerInput.RawMouseScale = new Vector2((float)width / (float)instance.Window.ClientBounds.Width, (float)height / (float)instance.Window.ClientBounds.Height);
-            if (!graphics.IsFullScreen)
-            {
-                num3 = Math.Max(graphics.PreferredBackBufferWidth, graphics.GraphicsDevice.Viewport.Width);
-                num4 = Math.Max(graphics.PreferredBackBufferHeight, graphics.GraphicsDevice.Viewport.Height);
-                if (num3 != graphics.PreferredBackBufferWidth || num4 != graphics.PreferredBackBufferHeight)
-                {
-                    flag2 = true;
-                }
-            }
-            else
-            {
-                num3 = graphics.PreferredBackBufferWidth;
-                num4 = graphics.PreferredBackBufferHeight;
-            }
-        }
-        else
-        {
-            PlayerInput.RawMouseScale = Vector2.One;
-            if (Platform.IsWindows)
-            {
-                form.MinimumSize = new Size(minScreenW, minScreenH);
-                if (flag)
-                {
-                    width = displayWidth[0];
-                    height = displayHeight[0];
-                }
-            }
-
-            width = Math.Min(width, maxScreenW);
-            height = Math.Min(height, maxScreenH);
-            num3 = graphics.GraphicsDevice.Viewport.Width;
-            num4 = graphics.GraphicsDevice.Viewport.Height;
-            flag2 = graphics.PreferredBackBufferWidth != graphics.GraphicsDevice.Viewport.Width || graphics.PreferredBackBufferHeight != graphics.GraphicsDevice.Viewport.Height;
-        }
-
-        if (Platform.IsWindows && !fullscreen && !flag2)
-        {
-            if (form.ClientSize.Width < graphics.PreferredBackBufferWidth)
-            {
-                width = form.ClientSize.Width;
-                flag2 = true;
-            }
-
-            if (form.ClientSize.Height < graphics.PreferredBackBufferHeight)
-            {
-                height = form.ClientSize.Height;
-                flag2 = true;
-            }
-        }
-
-        width &= 0x7FFFFFFE;
-        height &= 0x7FFFFFFE;
-        width = Math.Max(width, minScreenW);
-        height = Math.Max(height, minScreenH);
-        if (graphics.IsFullScreen != fullscreen)
-        {
-            graphics.PreferredBackBufferWidth = width;
-            graphics.PreferredBackBufferHeight = height;
-            graphics.ApplyChanges();
-            graphics.ToggleFullScreen();
-        }
-
-        if (width != num3 || height != num4 || flag2)
-        {
-            mapTime = 0;
-            if (gamePaused)
-            {
-                renderNow = true;
-            }
-
-            screenWidth = width;
-            screenHeight = height;
-            graphics.PreferredBackBufferWidth = screenWidth;
-            graphics.PreferredBackBufferHeight = screenHeight;
-            graphics.ApplyChanges();
-            PlayerInput.CacheOriginalScreenDimensions();
-            FixUIScale();
-            if (Main.OnResolutionChanged != null)
-            {
-                Main.OnResolutionChanged(new Vector2(screenWidth, screenHeight));
-            }
-
-            PendingResolutionWidth = screenWidth;
-            PendingResolutionHeight = screenHeight;
-            PlayerInput.CacheOriginalScreenDimensions();
-            if (Platform.IsWindows && !fullscreen)
-            {
-                if (screenBorderless)
-                {
-                    ApplyBorderlessResolution(form);
-                    form.FormBorderStyle = FormBorderStyle.None;
-                }
-                else
-                {
-                    form.FormBorderStyle = FormBorderStyle.Sizable;
-                }
-
-                form.SendToBack();
-                form.BringToFront();
-            }
-
-            Lighting.Initialize();
-            if (!drawToScreen && !_isResizingAndRemakingTargets)
-            {
-                _isResizingAndRemakingTargets = true;
-                instance.InitTargets();
-                _isResizingAndRemakingTargets = false;
-            }
-
-            UserInterface.ActiveInstance.Recalculate();
-            instance._needsMenuUIRecalculation = true;
-            Console.WriteLine(Language.GetTextValue("Misc.ResolutionChanged", width, height));
-        }
-
-        if (!graphics.SynchronizeWithVerticalRetrace)
-        {
-            graphics.SynchronizeWithVerticalRetrace = true;
-            graphics.ApplyChanges();
-        }
-    }
-
     public static void FixUIScale()
     {
         UIScale = UIScaleWanted;
-    }
-
-    public void FullscreenStartup()
-    {
-        startFullscreen = false;
-        int currentValue = graphics.PreferredBackBufferWidth;
-        int currentValue2 = graphics.PreferredBackBufferHeight;
-        Configuration.Get("DisplayWidth", ref currentValue);
-        Configuration.Get("DisplayHeight", ref currentValue2);
-        SetDisplayMode(currentValue, currentValue2, fullscreen: true);
-    }
-
-    public void UpdateDisplaySettings()
-    {
-        if (startFullscreen)
-        {
-            FullscreenStartup();
-        }
-
-        SetResolution(base.GraphicsDevice.Viewport.Width, base.GraphicsDevice.Viewport.Height);
     }
 
     public static void OpenPlayerSelectFromNet(Action onPlayerSelected)
